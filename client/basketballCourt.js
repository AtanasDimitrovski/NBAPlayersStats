/**
 * Created by Atanas on 23.06.2016.
 */


var podatoci = [
    {
        x: 92,
        y: 223,
        made: 0,
        gameId: 21500002
    },
    {
        x: -209,
        y: 141,
        made: 0,
        gameId: 21500002
    },
    {
        x: -120,
        y: 170,
        made: 0,
        gameId: 21500011
    },
    {
        x: 240,
        y: -16,
        made: 1,
        gameId: 21500011
    },
    {
        x: -178,
        y: 193,
        made: 1,
        gameId: 21500046
    },
    {
        x: 135,
        y: 210,
        made: 1,
        gameId: 21500046
    },
    {
        x: -1,
        y: 247,
        made: 1,
        gameId: 21500046
    },
    {
        x: 171,
        y: 188,
        made: 0,
        gameId: 21500046
    },
    {
        x: 42,
        y: 16,
        made: 0,
        gameId: 21500046
    },
    {
        x: -230,
        y: -6,
        made: 1,
        gameId: 21500046
    },
    {
        x: -55,
        y: 144,
        made: 1,
        gameId: 21500063
    },
    {
        x: -225,
        y: 124,
        made: 0,
        gameId: 21500063
    },
    {
        x: -84,
        y: 252,
        made: 0,
        gameId: 21500063
    },
    {
        x: 155,
        y: 149,
        made: 0,
        gameId: 21500078
    },
    {
        x: 51,
        y: 239,
        made: 1,
        gameId: 21500078
    },
    {
        x: -19,
        y: 149,
        made: 0,
        gameId: 21500078
    },
    {
        x: -241,
        y: 97,
        made: 0,
        gameId: 21500078
    },
    {
        x: 123,
        y: 208,
        made: 0,
        gameId: 21500078
    },
    {
        x: -179,
        y: 185,
        made: 0,
        gameId: 21500078
    },
    {
        x: 114,
        y: 218,
        made: 0,
        gameId: 21500106
    },
    {
        x: 74,
        y: 228,
        made: 0,
        gameId: 21500130
    },
    {
        x: -205,
        y: 139,
        made: 0,
        gameId: 21500130
    },
    {
        x: -205,
        y: 154,
        made: 0,
        gameId: 21500160
    },
    {
        x: -184,
        y: 174,
        made: 1,
        gameId: 21500160
    },
    {
        x: 132,
        y: 213,
        made: 1,
        gameId: 21500176
    },
    {
        x: 176,
        y: 170,
        made: 0,
        gameId: 21500176
    },
    {
        x: 104,
        y: 21,
        made: 1,
        gameId: 21500176
    },
    {
        x: -30,
        y: 249,
        made: 1,
        gameId: 21500176
    },
    {
        x: 4,
        y: 257,
        made: 0,
        gameId: 21500176
    },
    {
        x: -245,
        y: -11,
        made: 1,
        gameId: 21500191
    },
    {
        x: -163,
        y: 219,
        made: 1,
        gameId: 21500191
    },
    {
        x: 109,
        y: 85,
        made: 0,
        gameId: 21500191
    },
    {
        x: 60,
        y: 169,
        made: 0,
        gameId: 21500203
    },
    {
        x: 143,
        y: 203,
        made: 0,
        gameId: 21500203
    },
    {
        x: -235,
        y: -11,
        made: 0,
        gameId: 21500203
    },
    {
        x: -7,
        y: 7,
        made: 0,
        gameId: 21500203
    },
    {
        x: -248,
        y: 51,
        made: 1,
        gameId: 21500203
    },
    {
        x: 9,
        y: 249,
        made: 0,
        gameId: 21500219
    },
    {
        x: 109,
        y: 224,
        made: 1,
        gameId: 21500219
    },
    {
        x: -243,
        y: -11,
        made: 1,
        gameId: 21500219
    },
    {
        x: 228,
        y: 31,
        made: 0,
        gameId: 21500227
    },
    {
        x: 110,
        y: 26,
        made: 0,
        gameId: 21500227
    },
    {
        x: -189,
        y: 185,
        made: 0,
        gameId: 21500227
    },
    {
        x: 97,
        y: 228,
        made: 0,
        gameId: 21500227
    },
    {
        x: 148,
        y: 198,
        made: 1,
        gameId: 21500240
    },
    {
        x: -228,
        y: 51,
        made: 0,
        gameId: 21500262
    },
    {
        x: 227,
        y: -16,
        made: 0,
        gameId: 21500262
    },
    {
        x: 174,
        y: 175,
        made: 0,
        gameId: 21500262
    },
    {
        x: 235,
        y: 33,
        made: 0,
        gameId: 21500288
    },
    {
        x: 6,
        y: 257,
        made: 0,
        gameId: 21500288
    },
    {
        x: -194,
        y: 174,
        made: 1,
        gameId: 21500288
    },
    {
        x: -220,
        y: 129,
        made: 0,
        gameId: 21500288
    },
    {
        x: -241,
        y: 21,
        made: 0,
        gameId: 21500288
    },
    {
        x: 109,
        y: 249,
        made: 0,
        gameId: 21500334
    },
    {
        x: 148,
        y: 7,
        made: 0,
        gameId: 21500334
    },
    {
        x: 233,
        y: -6,
        made: 0,
        gameId: 21500334
    },
    {
        x: -199,
        y: 159,
        made: 0,
        gameId: 21500334
    },
    {
        x: 174,
        y: 200,
        made: 0,
        gameId: 21500334
    },
    {
        x: -55,
        y: 252,
        made: 1,
        gameId: 21500334
    },
    {
        x: -189,
        y: -1,
        made: 1,
        gameId: 21500334
    },
    {
        x: 223,
        y: -1,
        made: 1,
        gameId: 21500334
    },
    {
        x: 10,
        y: 262,
        made: 1,
        gameId: 21500334
    },
    {
        x: 148,
        y: 188,
        made: 1,
        gameId: 21500334
    },
    {
        x: -151,
        y: 178,
        made: 1,
        gameId: 21500405
    },
    {
        x: -11,
        y: 247,
        made: 0,
        gameId: 21500405
    },
    {
        x: -207,
        y: -11,
        made: 0,
        gameId: 21500405
    },
    {
        x: -238,
        y: 16,
        made: 0,
        gameId: 21500405
    },
    {
        x: -201,
        y: -5,
        made: 0,
        gameId: 21500405
    },
    {
        x: 122,
        y: 214,
        made: 0,
        gameId: 21500453
    },
    {
        x: -17,
        y: 3,
        made: 1,
        gameId: 21500453
    },
    {
        x: -61,
        y: 116,
        made: 1,
        gameId: 21500453
    },
    {
        x: 6,
        y: 247,
        made: 1,
        gameId: 21500453
    },
    {
        x: 137,
        y: 200,
        made: 0,
        gameId: 21500453
    },
    {
        x: 128,
        y: 205,
        made: 0,
        gameId: 21500453
    },
    {
        x: -114,
        y: 16,
        made: 0,
        gameId: 21500453
    },
    {
        x: 143,
        y: 8,
        made: 0,
        gameId: 21500453
    },
    {
        x: -145,
        y: 203,
        made: 0,
        gameId: 21500466
    },
    {
        x: 173,
        y: 190,
        made: 1,
        gameId: 21500466
    },
    {
        x: -230,
        y: -15,
        made: 0,
        gameId: 21500466
    },
    {
        x: -230,
        y: 111,
        made: 0,
        gameId: 21500466
    },
    {
        x: -171,
        y: 185,
        made: 0,
        gameId: 21500499
    },
    {
        x: 171,
        y: 175,
        made: 0,
        gameId: 21500499
    },
    {
        x: -16,
        y: 3,
        made: 1,
        gameId: 21500499
    },
    {
        x: 145,
        y: 169,
        made: 1,
        gameId: 21500499
    },
    {
        x: 171,
        y: 188,
        made: 0,
        gameId: 21500499
    },
    {
        x: 164,
        y: 180,
        made: 1,
        gameId: 21500499
    },
    {
        x: -196,
        y: 170,
        made: 1,
        gameId: 21500511
    },
    {
        x: 102,
        y: 7,
        made: 1,
        gameId: 21500622
    },
    {
        x: 141,
        y: 80,
        made: 1,
        gameId: 21500622
    },
    {
        x: 191,
        y: 149,
        made: 0,
        gameId: 21500622
    },
    {
        x: 1,
        y: 247,
        made: 1,
        gameId: 21500622
    },
    {
        x: -237,
        y: 111,
        made: 0,
        gameId: 21500622
    },
    {
        x: -122,
        y: 218,
        made: 0,
        gameId: 21500631
    },
    {
        x: -168,
        y: 180,
        made: 0,
        gameId: 21500631
    },
    {
        x: -238,
        y: -6,
        made: 0,
        gameId: 21500631
    },
    {
        x: -122,
        y: 218,
        made: 0,
        gameId: 21500631
    },
    {
        x: -168,
        y: 180,
        made: 0,
        gameId: 21500631
    },
    {
        x: -238,
        y: -6,
        made: 0,
        gameId: 21500631
    },
    {
        x: -217,
        y: 57,
        made: 1,
        gameId: 21500824
    },
    {
        x: 110,
        y: 18,
        made: 0,
        gameId: 21500824
    },
    {
        x: 120,
        y: 223,
        made: 0,
        gameId: 21500845
    },
    {
        x: 235,
        y: -5,
        made: 1,
        gameId: 21500917
    },
    {
        x: 50,
        y: 188,
        made: 1,
        gameId: 21500917
    },
    {
        x: 145,
        y: 28,
        made: 0,
        gameId: 21500917
    },
    {
        x: -163,
        y: 190,
        made: 0,
        gameId: 21500962
    },
    {
        x: 1,
        y: 1,
        made: 1,
        gameId: 21500962
    },
    {
        x: 194,
        y: 36,
        made: 0,
        gameId: 21500962
    },
    {
        x: 177,
        y: 175,
        made: 1,
        gameId: 21500962
    },
    {
        x: 177,
        y: 183,
        made: 0,
        gameId: 21500962
    },
    {
        x: 240,
        y: 16,
        made: 1,
        gameId: 21500983
    },
    {
        x: 164,
        y: 190,
        made: 1,
        gameId: 21501033
    },
    {
        x: 33,
        y: 247,
        made: 1,
        gameId: 21501033
    },
    {
        x: 212,
        y: 156,
        made: 0,
        gameId: 21501033
    },
    {
        x: -89,
        y: 95,
        made: 0,
        gameId: 21501033
    },
    {
        x: -153,
        y: 232,
        made: 1,
        gameId: 21501044
    },
    {
        x: -30,
        y: 252,
        made: 1,
        gameId: 21501044
    },
    {
        x: 97,
        y: 224,
        made: 0,
        gameId: 21501111
    },
    {
        x: -243,
        y: 11,
        made: 0,
        gameId: 21501111
    },
    {
        x: -240,
        y: -1,
        made: 1,
        gameId: 21501111
    },
    {
        x: 69,
        y: 232,
        made: 1,
        gameId: 21501111
    },
    {
        x: 110,
        y: 237,
        made: 0,
        gameId: 21501111
    },
    {
        x: 135,
        y: 213,
        made: 0,
        gameId: 21501122
    },
    {
        x: -106,
        y: 244,
        made: 1,
        gameId: 21501122
    },
    {
        x: -245,
        y: -11,
        made: 0,
        gameId: 21501159
    },
    {
        x: 0,
        y: 1,
        made: 1,
        gameId: 21501159
    },
    {
        x: -91,
        y: 267,
        made: 0,
        gameId: 21501159
    },
    {
        x: 74,
        y: 254,
        made: 1,
        gameId: 21501159
    },
    {
        x: -230,
        y: -10,
        made: 1,
        gameId: 21501159
    },
    {
        x: -237,
        y: -1,
        made: 1,
        gameId: 21501165
    },
    {
        x: 202,
        y: 75,
        made: 0,
        gameId: 21501165
    },
    {
        x: -104,
        y: 134,
        made: 1,
        gameId: 21501165
    },
    {
        x: 79,
        y: 16,
        made: 1,
        gameId: 21501220
    },
    {
        x: -186,
        y: 175,
        made: 0,
        gameId: 21501220
    },
    {
        x: 128,
        y: 247,
        made: 0,
        gameId: 21501220
    },
    {
        x: -156,
        y: 80,
        made: 0,
        gameId: 21501220
    },
    {
        x: -176,
        y: 183,
        made: 0,
        gameId: 21501220
    },
    {
        x: 171,
        y: 180,
        made: 1,
        gameId: 21501220
    },
    {
        x: 22,
        y: 95,
        made: 1,
        gameId: 21501220
    },
    {
        x: -232,
        y: 115,
        made: 0,
        gameId: 21501220
    },
    {
        x: 143,
        y: -16,
        made: 1,
        gameId: 21501220
    },
    {
        x: -148,
        y: 41,
        made: 0,
        gameId: 21501220
    }
];

opts = {
    // basketball hoop diameter (ft)
    basketDiameter: 1.5,
    // distance from baseline to backboard (ft)
    basketProtrusionLength: 4,
    // backboard width (ft)
    basketWidth: 6,
    // title of hexagon color legend
    colorLegendTitle: 'Efficiency',
    // label for starting of hexagon color range
    colorLegendStartLabel: '< avg',
    // label for ending of hexagon color range
    colorLegendEndLabel: '> avg',
    // full length of basketball court (ft)
    courtLength: 94,
    // full width of basketball court (ft)
    courtWidth: 50,
    // distance from baseline to free throw line (ft)
    freeThrowLineLength: 19,
    // radius of free throw line circle (ft)
    freeThrowCircleRadius: 6,
    // d3 scale for hexagon colors
    heatScale: d3.scale.quantize()
        .domain([0, 1])
        .range(['#5458A2', '#6689BB', '#FADC97', '#F08460', '#B02B48']),
    // height of svg
    height: undefined,
    // method of aggregating points into a bin
    hexagonBin: function (point, bin) {
        var attempts = point.attempts || 1;
        var made = +point.made || 0;
        bin.attempts = (bin.attempts || 0) + attempts;
        bin.made = (bin.made || 0) + made;
    },
    // how many points does a bin need to be visualized
    hexagonBinVisibleThreshold: 1,
    // method to determine value to be used with specified heatScale
    hexagonFillValue: function(d) {  return d.made/d.attempts; },
    // bin size with regards to courth width/height (ft)
    hexagonRadius: .75,
    // discrete hexagon size values that radius value is mapped to
    hexagonRadiusSizes: [0, .4, .6, .75],
    // how many points in a bin to consider it while building radius scale
    hexagonRadiusThreshold: 2,
    // method to determine radius value to be used in radius scale
    hexagonRadiusValue: function (d) { return d.attempts; },
    // width of key marks (dashes on side of the paint) (ft)
    keyMarkWidth: .5,
    // width the key (paint) (ft)
    keyWidth: 16,
    // radius of restricted circle (ft)
    restrictedCircleRadius: 4,
    // title of hexagon size legend
    sizeLegendTitle: 'Frequency',
    // label of start of hexagon size legend
    sizeLegendSmallLabel: 'low',
    // label of end of hexagon size legend
    sizeLegendLargeLabel: 'high',
    // distance from baseline where three point line because circular (ft)
    threePointCutoffLength: 14,
    // distance of three point line from basket (ft)
    threePointRadius: 23.75,
    // distance of corner three point line from basket (ft)
    threePointSideRadius: 22,
    // title of chart
    title: 'Shot chart',
    // method to determine x position of a bin on the court
    translateX: function (d) { return d.x; },
    // method to determine y position of a bin on the court
    translateY: function (d) { return this._visibleCourtLength - d.y; },
    // width of svg
    width: 500
}

const coefficient =  0.79521276595;

var o = opts

calculateVisibleCourtLength = function () {
    var halfCourtLength = o.courtLength / 2;
    var threePointLength = o.threePointRadius +
        o.basketProtrusionLength;
    o.visibleCourtLength = threePointLength +
        (halfCourtLength - threePointLength) / 2;
}

calculateVisibleCourtLength()

// helper to create an arc path
appendArcPath = function (base, radius, startAngle, endAngle) {
    var points = 30;

    var angle = d3.scale.linear()
        .domain([0, points - 1])
        .range([startAngle, endAngle]);

    var line = d3.svg.line.radial()
        .interpolate("basis")
        .tension(0)
        .radius(radius)
        .angle(function(d, i) { return angle(i); });

    return base.append("path").datum(d3.range(points))
        .attr("d", line);
}

// draw basketball court
var drawCourt = function () {
    var base = d3.select("svg")
        .attr('width', o.width)
        .attr('viewBox', "0 0 " + o.courtWidth + " " + o.visibleCourtLength)
        .append('g')
        .attr('class', 'shot-chart-court');
    if (o.height) base.attr('height', o.height);

    console.log(o.visibleCourtLength);

    for (var i=0; i<47; i++){
        base.append("text")
            .attr("x", 0)
            .attr("y", i)
            .text("Y: " + i)
            .attr("font-size", "0.5px")
    }



    base.append("rect")
        .attr('class', 'shot-chart-court-key')
        .attr("x", (o.courtWidth / 2 - o.keyWidth / 2))
        .attr("y", (o.visibleCourtLength - o.freeThrowLineLength))
        .attr("width", o.keyWidth)
        .attr("height", o.freeThrowLineLength);

    base.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", 50)
        .attr("height", 47)

    base.append("line")
        .attr('class', 'shot-chart-court-baseline')
        .attr("x1", 0)
        .attr("y1", o.visibleCourtLength)
        .attr("x2", o.courtWidth)
        .attr("y2", o.visibleCourtLength);

    var tpAngle = Math.atan(o.threePointSideRadius /
        (o.threePointCutoffLength - o.basketProtrusionLength - o.basketDiameter/2));
    appendArcPath(base, o.threePointRadius, -1 * tpAngle, tpAngle)
        .attr('class', 'shot-chart-court-3pt-line')
        .attr("transform", "translate(" + (o.courtWidth / 2) + ", " +
        (o.visibleCourtLength - o.basketProtrusionLength - o.basketDiameter / 2) +
        ")");

    [1, -1].forEach(function (n) {
        base.append("line")
            .attr('class', 'shot-chart-court-3pt-line')
            .attr("x1", o.courtWidth / 2 + o.threePointSideRadius * n)
            .attr("y1", o.visibleCourtLength - o.threePointCutoffLength)
            .attr("x2", o.courtWidth / 2 + o.threePointSideRadius * n)
            .attr("y2", o.visibleCourtLength);
    });

    appendArcPath(base, o.restrictedCircleRadius, -1 * Math.PI/2, Math.PI/2)
        .attr('class', 'shot-chart-court-restricted-area')
        .attr("transform", "translate(" + (o.courtWidth / 2) + ", " +
        (o.visibleCourtLength - o.basketProtrusionLength - o.basketDiameter / 2) + ")");

    appendArcPath(base, o.freeThrowCircleRadius, -1 * Math.PI/2, Math.PI/2)
        .attr('class', 'shot-chart-court-ft-circle-top')
        .attr("transform", "translate(" + (o.courtWidth / 2) + ", " +
        (o.visibleCourtLength - o.freeThrowLineLength) + ")");

    appendArcPath(base, o.freeThrowCircleRadius, Math.PI/2, 1.5 * Math.PI)
        .attr('class', 'shot-chart-court-ft-circle-bottom')
        .attr("transform", "translate(" + (o.courtWidth / 2) + ", " +
        (o.visibleCourtLength - o.freeThrowLineLength) + ")");

    [7, 8, 11, 14].forEach(function (mark) {
        [1, -1].forEach(function (n) {
            base.append("line")
                .attr('class', 'shot-chart-court-key-mark')
                .attr("x1", o.courtWidth / 2 + o.keyWidth / 2 * n + o.keyMarkWidth * n)
                .attr("y1", o.visibleCourtLength - mark)
                .attr("x2", o.courtWidth / 2 + o.keyWidth / 2 * n)
                .attr("y2", o.visibleCourtLength - mark)
        });
    });

    base.append("line")
        .attr('class', 'shot-chart-court-backboard')
        .attr("x1", o.courtWidth / 2 - o.basketWidth / 2)
        .attr("y1", o.visibleCourtLength - o.basketProtrusionLength)
        .attr("x2", o.courtWidth / 2 + o.basketWidth / 2)
        .attr("y2", o.visibleCourtLength - o.basketProtrusionLength)

    base.append("circle")
        .attr('class', 'shot-chart-court-hoop')
        .attr("cx", o.courtWidth / 2)
        .attr("cy", o.visibleCourtLength - o.basketProtrusionLength - o.basketDiameter / 2)
        .attr("r", o.basketDiameter / 2)

    for (var i=0; i<podatoci.length; i++){

        if (podatoci[i].made==1) {
            base.append("circle")
                .attr("cx", 49.5 - ((podatoci[i].x + 250) / 10))
                .attr("cy", 35.5 - (((podatoci[i].y + 30) / 10)))
                .attr("r", 0.3)
                .style("fill", "green");
        }else{
            base.append("circle")
                .attr("cx", 49.5 - ((podatoci[i].x + 250) / 10))
                .attr("cy", 35.5 - (((podatoci[i].y + 30) / 10)))
                .attr("r", 0.3)
                .style("fill", "red");
        }
    }

    console.log("Visina: " + document.getElementById('svg1').getBoundingClientRect().height)

}

drawCourt()
